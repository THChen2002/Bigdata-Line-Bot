{% extends 'admin/base.html' %}
{% block title %}後台管理系統 - 數據分析{% endblock %}
{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let levelCounts = JSON.parse('{{ level_counts|tojson|safe }}');
</script>
<script src="{{ url_for('static', filename='js/admin/index.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/index.css') }}">
{% endblock %}
{% block content %}
<!-- LIFF Loading -->
<div id="liffLoading" class="d-flex justify-content-center align-items-center vh-100 flex-column">
    <div class="spinner-border text-success" role="status"></div>
    <p class="mt-3">正在驗證 LINE 登入，請稍候...</p>
</div>

<div id="mainContent" class="d-none">
    <h2 class="mb-4">數據分析</h2>
    <div class="row g-4">
        <!-- 會員人數儀表板 -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="stat-label">會員總數</div>
                <div class="stat-value text-primary" id="total-members-card">0</div>
            </div>
        </div>
            <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="stat-label">非會員人數</div>
                <div class="stat-value text-secondary" id="non-members-card">0</div>
            </div>
        </div>
        <div class="col-xl-6 col-md-12">
            <div class="stat-card p-0 d-flex justify-content-around">
                <div class="text-center p-4">
                    <div class="stat-label">Lv1 請老師喝杯水</div>
                    <div class="stat-value" style="color:#0d6efd;" id="level1-card">0</div>
                </div>
                <div class="vr my-3"></div>
                <div class="text-center p-4">
                    <div class="stat-label">Lv2 請老師吃便當</div>
                    <div class="stat-value" style="color:#198754;" id="level2-card">0</div>
                </div>
                <div class="vr my-3"></div>
                <div class="text-center p-4">
                    <div class="stat-label">Lv3 請老師吃大餐</div>
                    <div class="stat-value" style="color:#ffc107;" id="level3-card">0</div>
                </div>
            </div>
        </div>
        <!-- 會員人數圖表 -->
        <div class="col-12">
            <div class="stat-card">
                <h5 class="mb-3 card-title">付費會員等級分佈</h5>
                <div style="height: 350px;">
                    <canvas id="membersChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}